/*
permutation test for mortality 
*/

/*load data*/
use "Tables_data", clear
set more off

/*gen placebo interactions*/
foreach var in _destination_km1 _destination_km2 _destination_km3 _destination_km4 _destination_km5   _destination_km7 _destination_km8 _destination_km9 _destination_km10 _destination_km11 _destination_km13 _destination_km14 _destination_km15 _destination_km16 _destination_km17 _destination_km18 _destination_km19 _destination_km20 _destination_km21 _destination_km22 _destination_km23 _destination_km24 _destination_km25 _destination_km26 _destination_km27 _destination_km29 _destination_km30 _destination_km31 _destination_km32 _destination_km33 _destination_km34 _destination_km35 _destination_km36 _destination_km37 _destination_km38 _destination_km39 _destination_km40 _destination_km41 _destination_km42 _destination_km43 _destination_km44 _destination_km45 _destination_km46 _destination_km47 _destination_km48 _destination_km50 _destination_km51 _destination_km52 _destination_km53 _destination_km54 _destination_km55 _destination_km56 _destination_km57 _destination_km58 _destination_km59 _destination_km60 _destination_km61 _destination_km62 _destination_km63 _destination_km64 _destination_km65 _destination_km66 _destination_km67 _destination_km68 _destination_km69 _destination_km70 _destination_km71 _destination_km72 _destination_km73 _destination_km74 _destination_km75 _destination_km76 _destination_km77 _destination_km79 _destination_km80 _destination_km81 _destination_km83 _destination_km84 _destination_km85 _destination_km86 _destination_km87 _destination_km88 _destination_km89 _destination_km90 _destination_km91 _destination_km92 _destination_km93 _destination_km94 _destination_km95 _destination_km96 _destination_km97 _destination_km98 _destination_km99 _destination_km100 _destination_km101 _destination_km102 _destination_km103 _destination_km104 _destination_km105 _destination_km106 _destination_km107 _destination_km108 _destination_km109 _destination_km110 _destination_km111 _destination_km112 _destination_km113 _destination_km114 _destination_km115 _destination_km116 _destination_km117 _destination_km118 _destination_km119 _destination_km120 _destination_km121 _destination_km122 _destination_km123 _destination_km124 _destination_km125 _destination_km126 _destination_km127 _destination_km128 _destination_km129 _destination_km130 _destination_km131 _destination_km132 _destination_km133 _destination_km135 _destination_km136 _destination_km137 _destination_km138 _destination_km139 _destination_km140 _destination_km141 _destination_km142 _destination_km143 _destination_km145 _destination_km146 _destination_km147 _destination_km148 _destination_km149 _destination_km150 _destination_km151 _destination_km152 _destination_km153 _destination_km154 _destination_km155 _destination_km156 _destination_km157 _destination_km158 _destination_km159 _destination_km160 _destination_km162 _destination_km163 _destination_km164 _destination_km165 _destination_km166 _destination_km167 _destination_km168 _destination_km169 _destination_km170 _destination_km171 _destination_km172 _destination_km173 _destination_km175 _destination_km176 _destination_km177 _destination_km178 _destination_km179 _destination_km180 _destination_km181 _destination_km182 _destination_km183 _destination_km184 _destination_km185 _destination_km186 _destination_km187 _destination_km188 _destination_km189 _destination_km190 _destination_km191 _destination_km192 _destination_km193 _destination_km194 _destination_km195 _destination_km196 _destination_km197 _destination_km198 _destination_km199 _destination_km200 _destination_km201 _destination_km202 _destination_km203 _destination_km204 _destination_km205 _destination_km206 _destination_km207 _destination_km208 _destination_km209 _destination_km210 _destination_km211 _destination_km212 _destination_km213 _destination_km214 _destination_km215 _destination_km216 _destination_km217 _destination_km218 _destination_km219 _destination_km220 _destination_km221 _destination_km222 _destination_km223 _destination_km224 _destination_km225 _destination_km226 _destination_km227 _destination_km228 _destination_km229 _destination_km230 _destination_km231 _destination_km232 _destination_km233 _destination_km234 _destination_km235 _destination_km236 _destination_km237 _destination_km238 _destination_km239 _destination_km240 _destination_km242 _destination_km243 _destination_km244 _destination_km245 _destination_km246 _destination_km247 _destination_km248 _destination_km249 _destination_km251 _destination_km253 _destination_km254 _destination_km256 _destination_km257 _destination_km258 _destination_km259 _destination_km260 _destination_km261 _destination_km262 _destination_km263 _destination_km264 _destination_km265 _destination_km266 _destination_km267 _destination_km268 _destination_km269 _destination_km270 _destination_km271 _destination_km273 _destination_km274 _destination_km275 _destination_km276 _destination_km277 _destination_km278 _destination_km279 _destination_km280 _destination_km281 _destination_km282 _destination_km283 _destination_km284 _destination_km285 _destination_km286 _destination_km287 _destination_km288 _destination_km289 _destination_km290 _destination_km291 _destination_km292 _destination_km293 _destination_km294 _destination_km295 _destination_km296 _destination_km298 _destination_km299 _destination_km300 _destination_km301 _destination_km302 _destination_km303 _destination_km304 _destination_km305 _destination_km306 _destination_km307 _destination_km308 _destination_km309 _destination_km310 _destination_km311 _destination_km314 _destination_km315 _destination_km317 _destination_km318 _destination_km319 _destination_km320 _destination_km321 _destination_km322 _destination_km323 _destination_km324 _destination_km325 _destination_km326 _destination_km327 _destination_km328 _destination_km329 _destination_km330 _destination_km331 _destination_km332 _destination_km333 _destination_km334 _destination_km335 _destination_km336 _destination_km337 _destination_km339 _destination_km340 _destination_km341 _destination_km342 _destination_km343 _destination_km344 _destination_km345 _destination_km346 _destination_km347 _destination_km348 _destination_km349 _destination_km350 _destination_km352 _destination_km353 _destination_km354 _destination_km355 _destination_km356 _destination_km357 _destination_km358 _destination_km360 _destination_km361 _destination_km362 _destination_km363 _destination_km364 _destination_km365 _destination_km366 _destination_km367 _destination_km368 _destination_km369 _destination_km370 _destination_km371 _destination_km372 _destination_km373 _destination_km374 _destination_km375 _destination_km376 _destination_km377 _destination_km378 _destination_km379 _destination_km380 _destination_km381 _destination_km382 _destination_km384 _destination_km385 _destination_km386 _destination_km387 _destination_km388 _destination_km389 _destination_km390 _destination_km391 _destination_km392 _destination_km393 _destination_km394 _destination_km395 _destination_km396 _destination_km398 _destination_km402 _destination_km403 _destination_km404 _destination_km405 _destination_km406 _destination_km407 _destination_km408 _destination_km409 _destination_km410 _destination_km411 _destination_km412 _destination_km413 _destination_km414 _destination_km415 _destination_km416 _destination_km418 _destination_km420 _destination_km421 _destination_km422 _destination_km425 _destination_km426 _destination_km427 _destination_km428 _destination_km429 _destination_km430 _destination_km431 _destination_km432 _destination_km433 _destination_km434 _destination_km435 _destination_km436 _destination_km437 _destination_km438 _destination_km439 _destination_km440 _destination_km441 _destination_km442 _destination_km443 _destination_km444 _destination_km445 _destination_km446 _destination_km447 _destination_km448 _destination_km449 _destination_km450 _destination_km451 _destination_km452 _destination_km453 _destination_km454 _destination_km455 _destination_km456 _destination_km457 _destination_km458 _destination_km459 _destination_km460 _destination_km461 _destination_km462 _destination_km464 _destination_km465 _destination_km466 _destination_km467 _destination_km468 _destination_km469 _destination_km470 _destination_km471 _destination_km473 _destination_km474 _destination_km475 _destination_km476 _destination_km477 _destination_km478 _destination_km479 _destination_km480 _destination_km481 _destination_km482 _destination_km483 _destination_km484 _destination_km485 _destination_km487 _destination_km488 _destination_km489 _destination_km490 _destination_km491 _destination_km492 _destination_km493 _destination_km494 _destination_km495 _destination_km496 _destination_km497 _destination_km498 _destination_km500 _destination_km501 _destination_km502 {
replace `var'=-`var'/1000
sum `var', detail 
gen max=r(min)
replace max=-max
replace `var'=`var'+max
drop max 
gen `var'_post_bmale = `var'*post*black*male 
gen `var'_post_black=`var'*post*black
gen `var'_post_male = `var'*post*male
gen `var'_black=`var'*black
gen `var'_male = `var'*male
gen `var'_bmale = `var'*black*male  
}


preserve
reghdfe $outcome  _destination_km1_post_bmale  _destination_km1_post_black _destination_km1_post_male  $controls    , ///
absorb(i.black#i.male#i.sea  i.sea#i.yrs i.yrs#i.black#i.male) dofadjustments(clusters) vce(cluster sea)
regsave using "resultsquad.dta", replace 
restore

foreach var in _destination_km2 _destination_km3 _destination_km4 _destination_km5     _destination_km7 _destination_km8 _destination_km9 _destination_km10 _destination_km11 _destination_km13 _destination_km14 _destination_km15 _destination_km16 _destination_km17 _destination_km18 _destination_km19 _destination_km20 _destination_km21 _destination_km22 _destination_km23 _destination_km24 _destination_km25 _destination_km26 _destination_km27 _destination_km29 _destination_km30 _destination_km31 _destination_km32 _destination_km33 _destination_km34 _destination_km35 _destination_km36 _destination_km37 _destination_km38 _destination_km39 _destination_km40 _destination_km41 _destination_km42 _destination_km43 _destination_km44 _destination_km45 _destination_km46 _destination_km47 _destination_km48 _destination_km50 _destination_km51 _destination_km52 _destination_km53 _destination_km54 _destination_km55 _destination_km56 _destination_km57 _destination_km58 _destination_km59 _destination_km60 _destination_km61 _destination_km62 _destination_km63 _destination_km64 _destination_km65 _destination_km66 _destination_km67 _destination_km68 _destination_km69 _destination_km70 _destination_km71 _destination_km72 _destination_km73 _destination_km74 _destination_km75 _destination_km76 _destination_km77 _destination_km79 _destination_km80 _destination_km81 _destination_km83 _destination_km84 _destination_km85 _destination_km86 _destination_km87 _destination_km88 _destination_km89 _destination_km90 _destination_km91 _destination_km92 _destination_km93 _destination_km94 _destination_km95 _destination_km96 _destination_km97 _destination_km98 _destination_km99 _destination_km100 _destination_km101 _destination_km102 _destination_km103 _destination_km104 _destination_km105 _destination_km106 _destination_km107 _destination_km108 _destination_km109 _destination_km110 _destination_km111 _destination_km112 _destination_km113 _destination_km114 _destination_km115 _destination_km116 _destination_km117 _destination_km118 _destination_km119 _destination_km120 _destination_km121 _destination_km122 _destination_km123 _destination_km124 _destination_km125 _destination_km126 _destination_km127 _destination_km128 _destination_km129 _destination_km130 _destination_km131 _destination_km132 _destination_km133 _destination_km135 _destination_km136 _destination_km137 _destination_km138 _destination_km139 _destination_km140 _destination_km141 _destination_km142 _destination_km143 _destination_km145 _destination_km146 _destination_km147 _destination_km148 _destination_km149 _destination_km150 _destination_km151 _destination_km152 _destination_km153 _destination_km154 _destination_km155 _destination_km156 _destination_km157 _destination_km158 _destination_km159 _destination_km160 _destination_km162 _destination_km163 _destination_km164 _destination_km165 _destination_km166 _destination_km167 _destination_km168 _destination_km169 _destination_km170 _destination_km171 _destination_km172 _destination_km173 _destination_km175 _destination_km176 _destination_km177 _destination_km178 _destination_km179 _destination_km180 _destination_km181 _destination_km182 _destination_km183 _destination_km184 _destination_km185 _destination_km186 _destination_km187 _destination_km188 _destination_km189 _destination_km190 _destination_km191 _destination_km192 _destination_km193 _destination_km194 _destination_km195 _destination_km196 _destination_km197 _destination_km198 _destination_km199 _destination_km200 _destination_km201 _destination_km202 _destination_km203 _destination_km204 _destination_km205 _destination_km206 _destination_km207 _destination_km208 _destination_km209 _destination_km210 _destination_km211 _destination_km212 _destination_km213 _destination_km214 _destination_km215 _destination_km216 _destination_km217 _destination_km218 _destination_km219 _destination_km220 _destination_km221 _destination_km222 _destination_km223 _destination_km224 _destination_km225 _destination_km226 _destination_km227 _destination_km228 _destination_km229 _destination_km230 _destination_km231 _destination_km232 _destination_km233 _destination_km234 _destination_km235 _destination_km236 _destination_km237 _destination_km238 _destination_km239 _destination_km240 _destination_km242 _destination_km243 _destination_km244 _destination_km245 _destination_km246 _destination_km247 _destination_km248 _destination_km249 _destination_km251 _destination_km253 _destination_km254 _destination_km256 _destination_km257 _destination_km258 _destination_km259 _destination_km260 _destination_km261 _destination_km262 _destination_km263 _destination_km264 _destination_km265 _destination_km266 _destination_km267 _destination_km268 _destination_km269 _destination_km270 _destination_km271 _destination_km273 _destination_km274 _destination_km275 _destination_km276 _destination_km277 _destination_km278 _destination_km279 _destination_km280 _destination_km281 _destination_km282 _destination_km283 _destination_km284 _destination_km285 _destination_km286 _destination_km287 _destination_km288 _destination_km289 _destination_km290 _destination_km291 _destination_km292 _destination_km293 _destination_km294 _destination_km295 _destination_km296 _destination_km298 _destination_km299 _destination_km300 _destination_km301 _destination_km302 _destination_km303 _destination_km304 _destination_km305 _destination_km306 _destination_km307 _destination_km308 _destination_km309 _destination_km310 _destination_km311 _destination_km314 _destination_km315 _destination_km317 _destination_km318 _destination_km319 _destination_km320 _destination_km321 _destination_km322 _destination_km323 _destination_km324 _destination_km325 _destination_km326 _destination_km327 _destination_km328 _destination_km329 _destination_km330 _destination_km331 _destination_km332 _destination_km333 _destination_km334 _destination_km335 _destination_km336 _destination_km337 _destination_km339 _destination_km340 _destination_km341 _destination_km342 _destination_km343 _destination_km344 _destination_km345 _destination_km346 _destination_km347 _destination_km348 _destination_km349 _destination_km350 _destination_km352 _destination_km353 _destination_km354 _destination_km355 _destination_km356 _destination_km357 _destination_km358 _destination_km360 _destination_km361 _destination_km362 _destination_km363 _destination_km364 _destination_km365 _destination_km366 _destination_km367 _destination_km368 _destination_km369 _destination_km370 _destination_km371 _destination_km372 _destination_km373 _destination_km374 _destination_km375 _destination_km376 _destination_km377 _destination_km378 _destination_km379 _destination_km380 _destination_km381 _destination_km382 _destination_km384 _destination_km385 _destination_km386 _destination_km387 _destination_km388 _destination_km389 _destination_km390 _destination_km391 _destination_km392 _destination_km393 _destination_km394 _destination_km395 _destination_km396 _destination_km398 _destination_km402 _destination_km403 _destination_km404 _destination_km405 _destination_km406 _destination_km407 _destination_km408 _destination_km409 _destination_km410 _destination_km411 _destination_km412 _destination_km413 _destination_km414 _destination_km415 _destination_km416 _destination_km418 _destination_km420 _destination_km421 _destination_km422 _destination_km425 _destination_km426 _destination_km427 _destination_km428 _destination_km429 _destination_km430 _destination_km431 _destination_km432 _destination_km433 _destination_km434 _destination_km435 _destination_km436 _destination_km437 _destination_km438 _destination_km439 _destination_km440 _destination_km441 _destination_km442 _destination_km443 _destination_km444 _destination_km445 _destination_km446 _destination_km447 _destination_km448 _destination_km449 _destination_km450 _destination_km451 _destination_km452 _destination_km453 _destination_km454 _destination_km455 _destination_km456 _destination_km457 _destination_km458 _destination_km459 _destination_km460 _destination_km461 _destination_km462 _destination_km464 _destination_km465 _destination_km466 _destination_km467 _destination_km468 _destination_km469 _destination_km470 _destination_km471 _destination_km473 _destination_km474 _destination_km475 _destination_km476 _destination_km477 _destination_km478 _destination_km479 _destination_km480 _destination_km481 _destination_km482 _destination_km483 _destination_km484 _destination_km485 _destination_km487 _destination_km488 _destination_km489 _destination_km490 _destination_km491 _destination_km492 _destination_km493 _destination_km494 _destination_km495 _destination_km496 _destination_km497 _destination_km498 _destination_km500 _destination_km501 _destination_km502 {
qui reghdfe $outcome `var'_post_bmale  `var'_post_black `var'_post_male  $controls    , ///
absorb(i.black#i.male#i.sea  i.sea#i.yrs i.yrs#i.black#i.male) dofadjustments(clusters) vce(cluster sea)
preserve
qui regsave using "resultsquad.dta",  append
restore 
}


use "resultsquad.dta", clear 

/*split variables for sea merge*/
	split var, p("_km")
	split var2, p("_post_bmale")
	drop if var2==var21
	rename var quadruple
	drop var1 var2
	destring var21, replace
	rename var21 sea

/*merge in distance data*/
	merge m:1 sea using "distance_macon_SEA.dta"
	drop _merge
/*save data*/
	save "quadcoeff.dta", replace 

	
/*histogram*/
*sea== 7 //macon county is in this sea 
	use "quadcoeff.dta", clear 
	hist coef if sea != 7, percent  xtitle("Quadruple Coefficient")  ///
	addplot(pci 0 $coeff_5b 10 $coeff_5b, lcolor(red) lwidth(thick)) lcolor(white) color(gs14) legend(off)  
	graph export "fig5_panelB.tif", replace

