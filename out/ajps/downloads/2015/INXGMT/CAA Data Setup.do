*****************************************;
** Do-file creates dataset for Reg-Gov **;
*****************************************;

Program: Stata13

#delimit;
set more off;
clear;

** Organize 2011 county unemployment data;
insheet using laucnty11.csv, names;
gen county_fips=substr(laus_code,3,5);
keep county_fips year percentunempl;
order county_fips year percentunempl;
sort county_fips year;
save unempl2011_tmp, replace;
clear;

** Create final dataset;
use afs9911_fedrep;

** Create public-private variable;
gen public=1 if govt!=.; replace public=0 if govt==.;
gen fed=1 if govt==1; replace fed=0 if govt!=1;
gen st=1 if govt==2; replace st=0 if govt!=2;
gen county=1 if govt==3; replace county=0 if govt!=3;
gen municipality=1 if govt==4; replace municipality=0 if govt!=4;
gen district=1 if govt==5; replace district=0 if govt!=5;
gen tribe=1 if govt==6; replace tribe=0 if govt!=6;
gen local=1 if govt==3 | govt==4 | govt==5; replace local=0 if local==.;

** Create major air source variable;
replace major=0 if major==.;

** Create power plant and hospital variables;
gen pp=1 if sic1==4911 | sic1==4931; replace pp=0 if pp==.;
gen hosp=1 if sic1==8062 | sic1==8063 | sic1==8069; replace hosp=0 if hosp==.;

** Create dummy for use in analysis;
gen set=1 if pp==1 | hosp==1;
replace set=0 if set!=1;

** Create insp and pun dummy;
gen insp=1 if insp_t>0; replace insp=0 if insp_t==0;
gen pun=1 if pun_t>0; replace pun=0 if pun_t==0;
gen pun_i=1 if stpun_inf_t>0 | epapun_inf_t>0; replace pun_i=0 if stpun_inf_t==0 & epapun_inf_t==0;
gen pun_f=1 if stpun_form_t>0 | epapun_form_t>0; replace pun_f=0 if stpun_form_t==0 & epapun_form_t==0;

** Create lags;
sort afsid year;
gen lhpv_year=hpv_year[_n-1] if afsid==afsid[_n-1];
gen lnc_year=nc_year[_n-1] if afsid==afsid[_n-1];
gen linsp_t=insp_t[_n-1] if afsid==afsid[_n-1];
gen lpun_t=pun_t[_n-1] if afsid==afsid[_n-1];
gen linsp=insp[_n-1] if afsid==afsid[_n-1];

** Drop DC;
drop if stab=="DC";

** Create year and state fixed effects;
tab year, gen(y);
tab stab, gen(s);
gen state = substr(afsid,1,2);
destring state, replace;

** Merge in county-level control variables;
gen county_fips=substr(afsid,1,5);

** Fix bad county fips;
replace county_fips="12086" if county_fips=="12025";
replace county_fips="02013" if county_fips=="02010";
replace county_fips="02232" if county_fips=="02231";

** Fix Massachusetts fips codes;
replace county_fips="25003" if county_fips=="117" & stab=="MA";
replace county_fips="25027" if stab=="MA" & cynm=="ASHBURNHAM" & county_fips=="25118"; 
replace county_fips="25027" if stab=="MA" & cynm=="ATHOL" & county_fips=="25118";  
replace county_fips="25027" if stab=="MA" & cynm=="AUBURN" & county_fips=="25118"; 
replace county_fips="25017" if stab=="MA" & cynm=="AYER" & county_fips=="25118"; 
replace county_fips="25027" if stab=="MA" & cynm=="BARRE" & county_fips=="25118"; 
replace county_fips="25021" if stab=="MA" & cynm=="BELLINGHAM" & county_fips=="25118"; 
replace county_fips="25027" if stab=="MA" & cynm=="BLACKSTONE" & county_fips=="25118"; 
replace county_fips="25027" if stab=="MA" & cynm=="BOLTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="BOYLSTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="BROOKFIELD" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="CHARLTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="CHARLTON cynm" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="CLINTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="DOUGLAS" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="DUDLEY" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="FITCHBURG" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="FORT DEVENS" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="GARDNER" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="GRAFTON" & county_fips=="25118";
replace county_fips="25017" if stab=="MA" & cynm=="GROTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="HARDWICK" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="HOLDEN" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="HOPEDALE" & county_fips=="25118";
replace county_fips="25017" if stab=="MA" & cynm=="HOPKINTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="HUBBARDSTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="LANCASTER" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="LEOMINSTER" & county_fips=="25118";
replace county_fips="25017" if stab=="MA" & cynm=="LITTLETON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="LUNENBURG" & county_fips=="25118";
replace county_fips="25017" if stab=="MA" & cynm=="MARLBOROUGH" & county_fips=="25118";
replace county_fips="25017" if stab=="MA" & cynm=="MAYNARD" & county_fips=="25118";
replace county_fips="25021" if stab=="MA" & cynm=="MEDWAY" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="MENDON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="MILLBURY" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="NORTH BROOKFIELD" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="NORTH GRAFTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="NORTHBOROUGH" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="OXFORD" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="PRINCETON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="RUTLAND" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="SHIRLEY" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="SHREWSBURY" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="SOUTH BARRE" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="SOUTHBRIDGE" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="SPENCER" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="STERLING" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="STURBRIDGE" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="SUTTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="TEMPLETON" & county_fips=="25118";
replace county_fips="25017" if stab=="MA" & cynm=="TOWNSEND" & county_fips=="25118";
replace county_fips="25017" if stab=="MA" & cynm=="TYNGSBOROUGH" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="UPTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="UXBRIDGE" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="WARREN" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="WEBSTER" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="WEST BOYLSTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="WEST BROOKFIELD" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="WESTBORO" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="WESTBOROUGH" & county_fips=="25118";
replace county_fips="25017" if stab=="MA" & cynm=="WESTFORD" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="WESTMINSTER" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="WHITINSVILLE" & county_fips=="25118";
replace county_fips="25017" if stab=="MA" & cynm=="WILMINGTON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="WINCHENDON" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="WORCESTER" & county_fips=="25118";

replace county_fips="25023" if stab=="MA" & cynm=="ABINGTON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="ACTON" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="ANDOVER" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="ARLINGTON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="ASHLAND" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="AVON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="BEDFORD" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="BELMONT" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="BEVERLY" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="BILLERICA" & county_fips=="25119";
replace county_fips="25027" if stab=="MA" & cynm=="BOLTON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="BOSTON" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="BRAINTREE" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="BRIDGEWATER" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="BRIGHTON" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="BROCKTON" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="BROOKLINE" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="BURLINGTON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="CAMBRIDGE" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="CANTON" & county_fips=="25119";
replace county_fips="25025" if stab=="MA" & cynm=="CHARLESTOWN" & county_fips=="25119";
replace county_fips="25025" if stab=="MA" & cynm=="CHELSEA" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="COHASSET" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="CONCORD" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="DANVERS" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="DEDHAM" & county_fips=="25119";
replace county_fips="25011" if stab=="MA" & cynm=="DEERFIELD" & county_fips=="25119";
replace county_fips="25025" if stab=="MA" & cynm=="DORCHESTER" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="DOVER" & county_fips=="25119";
replace county_fips="25025" if stab=="MA" & cynm=="EAST BOSTON" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="EAST BRIDGEWATE" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="EAST BRIDGEWATER" & county_fips=="25119";
replace county_fips="25005" if stab=="MA" & cynm=="EASTON" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="ESSEX" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="EVERETT" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="FRAMINGHAM" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="GLOUCESTER" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="HAMILTON" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="HANOVER" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="HANSON" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="HINGHAM" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="HOLBROOK" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="HOLLISTON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="HOPKINTON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="HUDSON" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="HULL" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="IPSWICH" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="LAWRENCE" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="LEXINGTON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="LINCOLN" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="LOWELL" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="LYNN" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="MALDEN" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="MANCHESTER" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="MARBLEHEAD" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="MARLBOROUGH" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="MARSHFIELD" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="MAYNARD" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="MEDFIELD" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="MEDFORD" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="MELROSE" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="MIDDLETON" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="MILLIS" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="MILTON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="NATICK" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="NEEDHAM" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="NEWBURYPORT" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="NEWTON" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="NORFOLK" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="NORTH READING" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="NORWELL" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="NORWOOD" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="PEABODY" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="PEMBROKE" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="PLYMOUTH" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="QUINCY" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="RANDOLPH" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="READING" & county_fips=="25119";
replace county_fips="25025" if stab=="MA" & cynm=="REVERE" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="ROCKLAND" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="ROCKPORT" & county_fips=="25119";
replace county_fips="25025" if stab=="MA" & cynm=="ROSLINDALE" & county_fips=="25119";
replace county_fips="25025" if stab=="MA" & cynm=="ROXBURY" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="SALEM" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="SAUGUS" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="SCITUATE" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="SHARON" & county_fips=="25119";
replace county_fips="25027" if stab=="MA" & cynm=="SHREWSBURY" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="SOMERVILE" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="SOMERVILLE" & county_fips=="25119";
replace county_fips="25025" if stab=="MA" & cynm=="SOUTH BOSTON" & county_fips=="25119";
replace county_fips="25027" if stab=="MA" & cynm=="SOUTHBOROUGH" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="STONEHAM" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="STOUGHTON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="STOW" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="SUDBURY" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="SWAMPSCOTT" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="TEWKSBURY" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="TOPSFIELD" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="WAKEFIELD" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="WALPOLE" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="WALTHAM" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="WATERTOWN" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="WAYLAND" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="WELLESLEY" & county_fips=="25119";
replace county_fips="25009" if stab=="MA" & cynm=="WENHAM" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="WEST BRIDGEWATER" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="WESTON" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="WESTWOOD" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="WEYMOUTH" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="WHITMAN" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="WILMINGTON" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="WINCHESTER" & county_fips=="25119";
replace county_fips="25025" if stab=="MA" & cynm=="WINTHROP" & county_fips=="25119";
replace county_fips="25017" if stab=="MA" & cynm=="WOBURN" & county_fips=="25119";
replace county_fips="25027" if stab=="MA" & cynm=="WORCESTER" & county_fips=="25119";
replace county_fips="25021" if stab=="MA" & cynm=="WRENTHAM" & county_fips=="25119";

replace county_fips="25023" if stab=="MA" & cynm=="ABINGTON" & county_fips=="25120";
replace county_fips="25017" if stab=="MA" & cynm=="ACTON" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="ACUSHNET" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="ATTLEBORO" & county_fips=="25120";
replace county_fips="25021" if stab=="MA" & cynm=="AVON" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="BARNSTABLE" & county_fips=="25120";
replace county_fips="25021" if stab=="MA" & cynm=="BELLINGHAM" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="BERKLEY" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="BOURNE" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="BREWSTER" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="BRIDGEWATER" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="BROCKTON" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="CARVER" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="CENTERVILLE" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="CHATHAM" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="DARTMOUTH" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="DENNIS" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="DIGHTON" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="DUXBURY" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="EAST BRIDGEWATER" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="EAST BRIDGEWATE" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="EAST FALMOUTH" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="EAST FREETOWN" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="EASTHAM" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="EASTON" & county_fips=="25120";
replace county_fips="25007" if stab=="MA" & cynm=="EDGARTOWN" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="FAIRHAVEN" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="FALL RIVER" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="FALMOUTH" & county_fips=="25120";
replace county_fips="25021" if stab=="MA" & cynm=="FOXBOROUGH" & county_fips=="25120";
replace county_fips="25021" if stab=="MA" & cynm=="FRANKLIN" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="FREETOWN" & county_fips=="25120";
replace county_fips="25007" if stab=="MA" & cynm=="GAY HEAD" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="HALIFAX" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="HANOVER" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="HANSON" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="HARWICH" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="HYANNIS" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="KINGSTON" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="LAKEVILLE" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="MANSFIELD" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="MARION" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="MASHPEE" & county_fips=="25120";
replace county_fips="25021" if stab=="MA" & cynm=="MEDWAY" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="MIDDLEBOROUGH" & county_fips=="25120";
replace county_fips="25027" if stab=="MA" & cynm=="MILFORD" & county_fips=="25120";
replace county_fips="25019" if stab=="MA" & cynm=="NANTUCKET" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="NEW BEDFORD" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="NORTH ATTLEBORO" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="NORTH ATTLEBOROUGH" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="NORTH DARTMOUTH" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="NORTON" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="NORWELL" & county_fips=="25120";
replace county_fips="25007" if stab=="MA" & cynm=="OAK BLUFFS" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="ORLEANS" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="PEMBROKE" & county_fips=="25120";
replace county_fips="25021" if stab=="MA" & cynm=="PLAINVILLE" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="PLYMOUTH" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="PLYMPTON" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="PROVINCETOWN" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="RAYHAM" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="RAYNHAM" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="REHOBOTH" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="ROCHESTER" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="ROCKLAND" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="SANDWICH" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="SCITUATE" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="SEEKONK" & county_fips=="25120";
replace county_fips="25021" if stab=="MA" & cynm=="SHARON" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="SOMERSET" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="SOUTH ATTLEBORO" & county_fips=="25120";
replace county_fips="25021" if stab=="MA" & cynm=="STOUGHTON" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="SWANSEA" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="TAUNTON" & county_fips=="25120";
replace county_fips="25007" if stab=="MA" & cynm=="TISBURY" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="WAREHAM" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="WEST BRIDGEWATER" & county_fips=="25120";
replace county_fips="25007" if stab=="MA" & cynm=="WEST TISBURY" & county_fips=="25120";
replace county_fips="25005" if stab=="MA" & cynm=="WESTPORT" & county_fips=="25120";
replace county_fips="25023" if stab=="MA" & cynm=="WHITMAN" & county_fips=="25120";
replace county_fips="25027" if stab=="MA" & cynm=="WORCESTER" & county_fips=="25120";
replace county_fips="25021" if stab=="MA" & cynm=="WRENTHAM" & county_fips=="25120";
replace county_fips="25001" if stab=="MA" & cynm=="YARMOUTH" & county_fips=="25120";

replace county_fips="25021" if stab=="MA" & cynm=="AMESBURY" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="ANDOVER" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="AYER" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="BILLERICA" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="CHELMSFORD" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="DRACUT" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="FORT DEVENS" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="GEORGETOWN" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="GROTON" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="GROVELAND" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="HAVERHILL" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="LAWRENCE" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="LITTLETON" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="LOWELL" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="MERRIMAC" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="MERRIMACK" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="METHUEN" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="NEWBURY" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="NEWBURYPORT" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="NORTH ANDOVER" & county_fips=="25121";

replace county_fips="25013" if stab=="MA" & cynm=="LUDLOW" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="AGAWAM" & county_fips=="25042";
replace county_fips="25015" if stab=="MA" & cynm=="AMHERST" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="SPRINGFIELD" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="CHICOPEE" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="EAST LONGMEADOW" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="ERVING" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="TURNERS FALLS" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="HOLYOKE" & county_fips=="25042";
replace county_fips="25003" if stab=="MA" & cynm=="PITTSFIELD" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="MONSON" & county_fips=="25042";
replace county_fips="25015" if stab=="MA" & cynm=="NORTHAMPTON" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="PALMER" & county_fips=="25042";
replace county_fips="25015" if stab=="MA" & cynm=="WESTFIELD" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="RUSSELL" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="SOUTHWICK" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="WEST SPRINGFIELD" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="MONTAGUE" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="ASHFIELD" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="WHATELY" & county_fips=="25042";
replace county_fips="25015" if stab=="MA" & cynm=="WARE" & county_fips=="25042";
replace county_fips="25015" if stab=="MA" & cynm=="SOUTH HADLEY" & county_fips=="25042";
replace county_fips="25015" if stab=="MA" & cynm=="EASTHAMPTON" & county_fips=="25042";
replace county_fips="25015" if stab=="MA" & cynm=="HATFIELD" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="DEERFIELD" & county_fips=="25042";
replace county_fips="25015" if stab=="MA" & cynm=="HADLEY" & county_fips=="25042";
replace county_fips="25015" if stab=="MA" & cynm=="GRANBY" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="ROWE" & county_fips=="25042";
replace county_fips="25015" if stab=="MA" & cynm=="BELCHERTOWN" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="GREENFIELD" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="WILBRAHAM" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="ORANGE" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="COLRAIN" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="NORTHFIELD" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="LONGMEADOW" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="SUNDERLAND" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="BRIMFIELD" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="HAMPDEN" & county_fips=="25042";
replace county_fips="25011" if stab=="MA" & cynm=="LEYDEN" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="WEST SPRINGFIEL" & county_fips=="25042";
replace county_fips="25013" if stab=="MA" & cynm=="W SPRINGFIELD" & county_fips=="25042";

replace county_fips="25003" if stab=="MA" & cynm=="PITTSFIELD" & county_fips=="25117";
replace county_fips="25003" if stab=="MA" & cynm=="PITTDFIELD" & county_fips=="25117";

replace county_fips="25003" if stab=="MA" & cynm=="DALTON" & county_fips=="25117";
replace county_fips="25003" if stab=="MA" & cynm=="ADAMS" & county_fips=="25117";
replace county_fips="25003" if stab=="MA" & cynm=="GREAT BARRINGTON" & county_fips=="25117";;
replace county_fips="25003" if stab=="MA" & cynm=="LEE" & county_fips=="25117";;
replace county_fips="25003" if stab=="MA" & cynm=="NORTH ADAMS" & county_fips=="25117";;
replace county_fips="25003" if stab=="MA" & cynm=="WILLIAMSTOWN" & county_fips=="25117";
replace county_fips="25003" if stab=="MA" & cynm=="SHEFFIELD" & county_fips=="25117";
replace county_fips="25003" if stab=="MA" & cynm=="HINSDALE" & county_fips=="25117";
replace county_fips="25003" if stab=="MA" & cynm=="LENOX" & county_fips=="25117";
replace county_fips="25003" if stab=="MA" & cynm=="STOCKBRIDGE" & county_fips=="25117";
replace county_fips="25003" if stab=="MA" & cynm=="WEST STOCKBRIDGE" & county_fips=="25117";

replace county_fips="25027" if stab=="MA" & cynm=="LEICESTER" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="NORTHBRIDGE" & county_fips=="25118";
replace county_fips="25027" if stab=="MA" & cynm=="SOUTBRIDGE" & county_fips=="25118";

replace county_fips="25017" if stab=="MA" & cynm=="CAMBRIGE" & county_fips=="25119";
replace county_fips="25023" if stab=="MA" & cynm=="EAST BRIDGEWATR" & county_fips=="120";
replace county_fips="25009" if stab=="MA" & cynm=="SALISBURY" & county_fips=="25121";
replace county_fips="25017" if stab=="MA" & cynm=="TEWKSBURY" & county_fips=="25121";
replace county_fips="25017" if stab=="MA" & cynm=="PEPPERELL" & county_fips=="25121";
replace county_fips="25009" if stab=="MA" & cynm=="ROWLEY" & county_fips=="25121";
replace county_fips="25009" if stab=="MA" & cynm=="WEST NEWBURY" & county_fips=="25121";
replace county_fips="25017" if stab=="MA" & cynm=="WESTFORD" & county_fips=="25121";
replace county_fips="25017" if stab=="MA" & cynm=="TYNGSBOROUGH" & county_fips=="25121";
replace county_fips="25009" if stab=="MA" & cynm=="WEST NEWBURY" & county_fips=="25121";
replace county_fips="25017" if stab=="MA" & cynm=="READING" & county_fips=="25121";
replace county_fips="25021" if stab=="MA" & cynm=="PLAINVILLE" & county_fips=="25121";

*br city county_fips state_fips if county_fips=="25042" | county_fips=="25117" | county_fips=="25118" | county_fips=="25119" | county_fips=="25120" | county_fips=="25121";
count if county_fips=="25042" | county_fips=="25117" | county_fips=="25118" | county_fips=="25119" | county_fips=="25120" | county_fips=="25121";
drop  if county_fips=="25042" | county_fips=="25117" | county_fips=="25118" | county_fips=="25119" | county_fips=="25120" | county_fips=="25121";  ** Gets rid of "not in city";
count if stab=="MA";

** Merge in 2011 unemployment rate;
sort county_fips year;
merge county_fips year using unempl2011_tmp;
tab _m;
drop _m;

sort county_fips year;
count;
merge county_fips year using countydata2;
** Note: countydata2 adds data to countydata for 02100, 51600, 51700, 51800 using afs_county_final (from EJ book chapter);
** Note: countydata2 adds data to countydata for 02232 using census.gov, 2010 only and alaska.gov for unemployment

** Drop portable facilities;
tab _m;
gen foo=substr(county_fips,3,3);
gen portable=1 if foo=="777" | foo=="997" | foo=="888";
drop if portable==1;
tab _m;
drop _m;

replace PercentUnemploy=percentunempl if year==2011;

** Cleanup'
tab year;
drop if afsid=="";

** Impute 2011 census data from 2010;
sort afsid year;
*replace PercentUnemploy=PercentUnemploy[_n-1] if afsid==afsid[_n-1] & year==2011;
replace PercentBlack=PercentBlack[_n-1] if afsid==afsid[_n-1] & year==2011;
replace PercentHisp=PercentHisp[_n-1] if afsid==afsid[_n-1] & year==2011;
replace PercentPoverty=PercentPoverty[_n-1] if afsid==afsid[_n-1] & year==2011;
replace MedHsInc=MedHsInc[_n-1] if afsid==afsid[_n-1] & year==2011;

** Impute handful of observations in LA with missing PercentUnemployment;
sort afsid year;
count if afsid==afsid[_n-1] & PercentUnemploy==.;
replace PercentUnemploy=PercentUnemploy[_n-1] if afsid==afsid[_n-1] & PercentUnemploy==.;

** Broomfield County;
** Use data from Boulder for Broomfield County;
replace PercentUnemploy=2.4 if county_fips=="08014" & year==2000;
replace PercentUnemploy=3.7 if county_fips=="08014" & year==2001;
replace PercentUnemploy=5.8 if county_fips=="08014" & year==2002;
replace PercentUnemploy=5.8 if county_fips=="08014" & year==2003;
replace PercentUnemploy=4.9 if county_fips=="08014" & year==2004;
replace PercentUnemploy=4.5 if county_fips=="08014" & year==2005;
replace PercentUnemploy=3.7 if county_fips=="08014" & year==2006;
replace PercentUnemploy=3.3 if county_fips=="08014" & year==2007;
replace PercentUnemploy=4.1 if county_fips=="08014" & year==2008;
replace PercentUnemploy=7 if county_fips=="08014" & year==2009;
replace PercentUnemploy=7.1 if county_fips=="08014" & year==2010;
replace PercentUnemploy=7.1 if county_fips=="08014" & year==2011;

replace PercentBlack=0.878 if county_fips=="08014" & year==2000;
replace PercentBlack=0.877 if county_fips=="08014" & year==2001;
replace PercentBlack=0.874 if county_fips=="08014" & year==2002;
replace PercentBlack=0.873 if county_fips=="08014" & year==2003;
replace PercentBlack=0.871 if county_fips=="08014" & year==2004;
replace PercentBlack=0.869 if county_fips=="08014" & year==2005;
replace PercentBlack=0.867 if county_fips=="08014" & year==2006;
replace PercentBlack=0.865 if county_fips=="08014" & year==2007;
replace PercentBlack=0.863 if county_fips=="08014" & year==2008;
replace PercentBlack=0.861 if county_fips=="08014" & year==2009;
replace PercentBlack=0.860 if county_fips=="08014" & year==2010;
replace PercentBlack=0.860 if county_fips=="08014" & year==2011;

replace PercentHisp=10.46 if county_fips=="08014" & year==2000;
replace PercentHisp=10.74 if county_fips=="08014" & year==2001;
replace PercentHisp=11.03 if county_fips=="08014" & year==2002;
replace PercentHisp=11.32 if county_fips=="08014" & year==2003;
replace PercentHisp=11.61 if county_fips=="08014" & year==2004;
replace PercentHisp=11.89 if county_fips=="08014" & year==2005;
replace PercentHisp=12.18 if county_fips=="08014" & year==2006;
replace PercentHisp=12.47 if county_fips=="08014" & year==2007;
replace PercentHisp=12.76 if county_fips=="08014" & year==2008;
replace PercentHisp=13.05 if county_fips=="08014" & year==2009;
replace PercentHisp=13.33 if county_fips=="08014" & year==2010;
replace PercentHisp=13.33 if county_fips=="08014" & year==2011;

replace PercentPoverty=13.6 if county_fips=="08014" & year==2000;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2001;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2002;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2003;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2004;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2005;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2006;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2007;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2008;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2009;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2010;
replace PercentPoverty=13.6 if county_fips=="08014" & year==2011;

replace MedHsInc=55861 if county_fips=="08014" & year==2000;
replace MedHsInc=56496.4 if county_fips=="08014" & year==2001;
replace MedHsInc=57131.8 if county_fips=="08014" & year==2002;
replace MedHsInc=57767.2 if county_fips=="08014" & year==2003;
replace MedHsInc=58402.6 if county_fips=="08014" & year==2004;
replace MedHsInc=59038 if county_fips=="08014" & year==2005;
replace MedHsInc=59673.4 if county_fips=="08014" & year==2006;
replace MedHsInc=60308.8 if county_fips=="08014" & year==2007;
replace MedHsInc=60944.2 if county_fips=="08014" & year==2008;
replace MedHsInc=61579.6 if county_fips=="08014" & year==2009;
replace MedHsInc=62215 if county_fips=="08014" & year==2010;
replace MedHsInc=62215 if county_fips=="08014" & year==2011;

** Drop handful of missing for Alaska;
drop if county_fips=="02201";
drop if county_fips=="02280";

save CAA_Dataset1, replace;


