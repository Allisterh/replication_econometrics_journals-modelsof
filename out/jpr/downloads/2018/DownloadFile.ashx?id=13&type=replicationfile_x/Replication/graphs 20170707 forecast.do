*one step paper 020811*organizational change estimatesclearset mem 500mset matsize 500use "/Users/sulivan/Documents/Old Macbook Air/RNA/1s2s/JPR RandR/rna weeks 20170620.dta", cleartsset weekgen newbeth=0replace newbeth=1 if week==52gen postnbi=0replace postnbi=1 if week>52gen decay2=0replace decay2=52 if week==53replace decay2=decay2[_n-1]-1 if week>53rename event Eventsrename observable Observable_Eventsrename unobservable Unobservable_Eventsrename orgchange Organizational_Changesrename newloc New_Locations**counterfactualforeach var of varlist Events Observable_Events Unobservable_Events Organizational_Changes New_Locations {arima `var'  newbeth postnbi Events decay2, arima(2, 0, 1) robustpredict `var'_f predict `var'_fse, stdpgen `var'_fse1=`var'_f+1.18*`var'_fsegen `var'_fse2=`var'_f-1.18*`var'_fsepredict `var'_cf replace `var'_cf=`var'_cf-_b[newbeth]-_b[postnbi]-(_b[decay2]*week) if week>52predict `var'_cfse, stdpgen `var'_cfse1=`var'_cf+1.18*`var'_cfsegen `var'_cfse2=`var'_cf-1.18*`var'_cfse**mfxmargin, dydx(newbeth)estout , cells("b margin_b") style(fixed)}*margins time, at(trt=1) pwcompare(effects) noestimcheck**graphforeach var of varlist Events Observable_Events Unobservable_Events Organizational_Changes New_Locations {twoway (tsline `var', recast(scatter) mcolor(navy) msize(small) msymbol(circle_hollow)) (tsline `var'_f, lcolor(gs2)) (tsline `var'_fse1, lcolor(gs5) lpattern(dot)) (tsline `var'_fse2, lcolor(gs5) lpattern(dot)) (tsline `var'_cf, lcolor(gs2) lpattern(dash)) (tsline `var'_cfse1, lcolor(gs5) lpattern(dot)) (tsline `var'_cfse2, lcolor(gs5) lpattern(dot)) (tsline `var')  if week>53, ytitle(`var') legend(order(1   "Observed"  2  "Predicted" 5  "Counter-factual") cols(3)) graphregion(fcolor(gs15) ifcolor(none))graph save  "/Users/sulivan/Documents/Old Macbook Air/RNA/1s2s/JPR RandR/`var'.gph", replace}rename surveil Events_Surveiledrename known_attendees Members_Identifiedrename total_ho Surveilance_Hoursforeach var of varlist Events_Surveiled  {arima `var'  newbeth postnbi Events decay2, arima(1, 0, 1) robustpredict `var'_f predict `var'_fse, stdpgen `var'_fse1=`var'_f+1.18*`var'_fsegen `var'_fse2=`var'_f-1.18*`var'_fsepredict `var'_cf replace `var'_cf=`var'_cf-_b[newbeth]-_b[postnbi]-(_b[decay2]*week) if week>52predict `var'_cfse, stdpgen `var'_cfse1=`var'_cf+1.18*`var'_cfsegen `var'_cfse2=`var'_cf-1.18*`var'_cfse**mfxmargin, dydx(newbeth)estout , cells("b margin_b") style(fixed)}foreach var of varlist Members_Identified  {arima `var'  newbeth postnbi Events present Events_Surveiled decay2, arima(1, 0, 0) robustpredict `var'_f predict `var'_fse, stdpgen `var'_fse1=`var'_f+1.18*`var'_fsegen `var'_fse2=`var'_f-1.18*`var'_fsepredict `var'_cf replace `var'_cf=`var'_cf-_b[newbeth]-_b[postnbi]-(_b[decay2]*week) if week>52predict `var'_cfse, stdpgen `var'_cfse1=`var'_cf+1.18*`var'_cfsegen `var'_cfse2=`var'_cf-1.18*`var'_cfse**mfxmargin, dydx(newbeth)estout , cells("b margin_b") style(fixed)}foreach var of varlist  Surveilance_Hours {arima `var'  newbeth postnbi  decay2, arima(1, 0, 0) robustpredict `var'_f predict `var'_fse, stdpgen `var'_fse1=`var'_f+1.18*`var'_fsegen `var'_fse2=`var'_f-1.18*`var'_fsepredict `var'_cf replace `var'_cf=`var'_cf-_b[newbeth]-_b[postnbi]-(_b[decay2]*week) if week>52predict `var'_cfse, stdpgen `var'_cfse1=`var'_cf+1.18*`var'_cfsegen `var'_cfse2=`var'_cf-1.18*`var'_cfse**mfxmargin, dydx(newbeth)estout , cells("b margin_b") style(fixed)}gen Members_Identified_Control=Members_Identified gen Events_Surveiled_Control=Events_Surveiledforeach var of varlist Events_Surveiled_Control {arima `var'  newbeth postnbi Events decay2 Surveilance_Hours, arima(1, 0, 1) robustpredict `var'_f predict `var'_fse, stdpgen `var'_fse1=`var'_f+1.18*`var'_fsegen `var'_fse2=`var'_f-1.18*`var'_fsepredict `var'_cf replace `var'_cf=`var'_cf-_b[newbeth]-_b[postnbi]-(_b[decay2]*week) if week>52predict `var'_cfse, stdpgen `var'_cfse1=`var'_cf+1.18*`var'_cfsegen `var'_cfse2=`var'_cf-1.18*`var'_cfse**mfxmargin, dydx(newbeth)estout , cells("b margin_b") style(fixed)}foreach var of varlist Members_Identified_Control  {arima `var'  newbeth postnbi Events present Events_Surveiled Surveilance_Hours decay2, arima(1, 0, 0) robustpredict `var'_f predict `var'_fse, stdpgen `var'_fse1=`var'_f+1.18*`var'_fsegen `var'_fse2=`var'_f-1.18*`var'_fsepredict `var'_cf replace `var'_cf=`var'_cf-_b[newbeth]-_b[postnbi]-(_b[decay2]*week) if week>52predict `var'_cfse, stdpgen `var'_cfse1=`var'_cf+1.18*`var'_cfsegen `var'_cfse2=`var'_cf-1.18*`var'_cfse**mfxmargin, dydx(newbeth)estout , cells("b margin_b") style(fixed)}**graphforeach var of varlist Events_Surveiled Members_Identified Surveilance_Hours Events_Surveiled_Control Members_Identified_Control {twoway (tsline `var', recast(scatter) mcolor(navy) msize(small) msymbol(circle_hollow)) (tsline `var'_f, lcolor(gs2)) (tsline `var'_fse1, lcolor(gs5) lpattern(dot)) (tsline `var'_fse2, lcolor(gs5) lpattern(dot)) (tsline `var'_cf, lcolor(gs2) lpattern(dash)) (tsline `var'_cfse1, lcolor(gs5) lpattern(dot)) (tsline `var'_cfse2, lcolor(gs5) lpattern(dot)) (tsline `var')  if week>53, ytitle(`var') legend(order(1   "Observed"  2  "Predicted" 5  "Counter-factual") cols(3)) graphregion(fcolor(gs15) ifcolor(none))graph save  "/Users/sulivan/Documents/Old Macbook Air/RNA/1s2s/JPR RandR/`var'.gph", replace}