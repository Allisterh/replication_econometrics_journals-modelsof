
*/Comparing the post-conflict periods that are generated by conflict that appear in both datasets. Start and end dates are the same as in ACD*/
use "Data\Replicating\Data\COW end and start dates_only one obsperconflict.dta", clear
save "Data\Replicating\Data\COW end and start dates_1", replace

rename firstwaryear warstarts
rename lastwaryear peacestarts

*/We identify when the peace ends*/
sort gwno warstarts
gen peacends=warstarts[_n+1]
replace peacends=2002 if peacends==.

gen samegwno=gwno[_n+1]
replace samegwno=1000 if samegwno==.
replace samegwno=samegwno-gwno
replace samegwno=50000 if samegwno==0
replace samegwno= 0 if samegwno<50000
replace samegwno=1 if samegwno==50000

replace peacends=peacends*samegwno
rename samegwno pcpcensored
replace pcpcensored=5 if pcpcensored==0
replace pcpcensored=0 if pcpcensored==1
replace pcpcensored=1 if pcpcensored==5

replace peacends=2002 if peacends==0
replace peacends=2002 if peacends==.

gen a=1
sort a gwno year
by a: gen warperiod=_n
drop a
gen primkey=(gwno*10000)+peacestarts
sort primkey
drop if peacestarts>=2002
sleep 2000
save, replace
save "Data\Replicating\Data\COW end and start dates_2.dta", replace

sort gwno warstarts
by gwno: gen n=_n
tab n
keep if n==1
keep gwno peacestarts location
expandcl 48, cluster(gwno) gen(hva)
rename peacestarts year
sort gwno
by gwno: gen n=_n
replace year=year+n-1
drop if year>2002


gen primkey=(gwno*10000)+year
sort primkey
merge primkey using "Data\Replicating\Data\COW end and start dates_1", keep (warperiod warstarts peacestarts peacends pcpcensored)
tab _merge

*/We must fill in the empty spaces*/
sort gwno year
replace warperiod = warperiod[_n-1] if missing(warperiod)
replace warstarts = warstarts[_n-1] if missing(warstarts)
replace peacestarts = peacestarts[_n-1] if missing(peacestarts)
replace peacends = peacends[_n-1] if missing(peacends)
replace pcpcensored = pcpcensored[_n-1] if missing(pcpcensored)

*/We remove the waryears*/
gen D=year-peacends
replace D=-1 if D==.
replace D=-1 if pcpcensored==1
drop if D>-1
drop D
save, replace

*/We generate a duration variable*/
rename warperiod pcperiod
sort pcperiod year
by pcperiod: gen pduration=_n

*/We generate a dummy which tells whether peace ends this year*/
gen peacefailed=year-peacends
replace peacefailed=-500 if peacefailed==-1
replace peacefailed=0 if peacefailed>-500
replace peacefailed=1 if peacefailed==-500
replace peacefailed=0 if pcpcensored==1
save, replace

*/ GDP data*/
*/Peaceperiods missing GDP data are removed*/
sort primkey
capture drop _merge
merge primkey using "Data\Original\Data\GDP Capita WorldBank.dta", keep( logGDPCap2  gdpgrowth1)

drop if _merge==2
drop _merge
drop if logGDPCap2==.
drop if gdpgrowth1==.
drop if gwno==645

*/We generate a fourpluss variable, a dummy telling if the war has lasted more than four years*/
gen plussfour=1 if pduration>=5
replace plussfour=0 if pduration<5

sort pcperiod pdur
capture ge entryr=pduration-1
capture by pcperiod: ge fentryr=entryr[1]

*/Analyzing*/
stset pduration, id(pcperiod) f(peacefailed) en(fentryr)
streg gdpgrowth1 plussfour, nohr robust dist (exponential)
eststo: streg logGDPCap2 gdpgrowth1 plussfour, nohr robust dist (exponential)










