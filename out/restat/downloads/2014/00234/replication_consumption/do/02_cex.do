/* REPLICATION FILES for the article:
Spillovers from High-Skill Consumption to Low-Skill Labor Markets 
Francesca Mazzolari and Giuseppe Ragusa
REStat, March 2013, 95(1), 74-86
* 
do file: 02_cex.do
*/

* This do file generates relevant variables for the analysis run on a sample drawn from the 2004 CEX Diary Survey
* The working sample is stored in the file diary04/cex_diary04.dta (generated by the do file 01_cex.do)
* The do file also contains the commands needed to replicate Table 1 and Figure 1 in the paper, as well as Table A1 and Figure A1 in the online appendix

* set path for WORKING DIRECTORY
cd "~/scratch/Rep/replication_consumption"set more offuse diary04/cex_diary04.dta, clear*****************************************************************************************************A. Generate variables and Descriptives*****************************************************************************************************WEIGHTS*The CUs (consumer units) in the Diary survey microdata files represent the U.S. population*In the original CEX files, the weighting variable "finlwt21" has been adjusted such that the sum of all CU weights for one month approximates one third of the U.S. population*consequently, the weights for 3 months (one quarter) of data approximate the total U.S. population*The file diary04/cex_diary04.dta is obtained by pooling 4 quarters of data*As a result, the weights for 4 quarters of data approximate 4 TIMES the total U.S. population*Expenditures are originally weekly amounts, so to get yearly expenditures from a dataset that pools the 4 quarters we should sum the (weekly)expenditure*weights*4 and then divide by 4!*we have transformed them in monthly amounts and collapsed the (up to) two weekly observations for each CU (that is, for each separate "newid") into one observation (one "cuid")*To get yearly expenditures from a dataset that pools the 4 quarters we should sum the (monthly)expenditure*weights and then divide by 4 and multiply by 2 (because 2 newid = 1 cuid)!*so, we divide the weight by two in order to obtain yearly expenditures in weighted tabulations.*ALSO, "finlwt21" is technically a FREQUENCY WEIGHT (it tells how many observations each entry represents); Stata would expect it to contain positive integers, while it has decimals*round "finlwt21" at the closest integer to be able to run weighted estimatesgen weight_round= round(finlwt21/2)*FAMILY TYPElabel define fam_type 1 HW_only 2 HW_6minus_oldstch 3 HW_6_17_oldstch 4 HW_17plus_oldstch 5 HW_other 6 sgle_dad 7 sgle_mom 8 single 9 otherCUlabel values fam_type fam_typetabulate fam_type year [fweight = weight_round], columngen HW=(fam_type<=5)*Working status of woman in husband and wife (HW) familiesgen woman_work=0 if HWrecode woman_work 0=1 if hrsprwk1~=. & sex_ref==2recode woman_work 0=1 if hrsprwk2~=. & sex2==2label define woman_work 0 WOM_NOTworking 1 WOM_worklabel values woman_work woman_workgen fam_type3=0recode fam_type3 0=1 if HW==1 & woman_work==0 recode fam_type3 0=2 if HW==1 & woman_work==1 recode fam_type3 0=3 if HW==0 label define fam_type3 1 "Husband & Housewife" 2 "Husband and Working Wife" 3 "Other families"label values fam_type3 fam_type3label var fam_type3 "type of family"*HEAD OF THE FAMILY*The family head is conventionally fixed to be the male in all husband/wife (HW) families*For comparison (see Table A1), we also set it equal to the woman (head_fem)***Age***gen     age_head= age_ref  if sex_ref==1 & HWreplace age_head= age2     if sex2==1    & HWreplace age_head= age_ref  if              HW==0gen     age_head_fem= age_ref  if sex_ref==2 & HWreplace age_head_fem= age2     if sex2==2    & HWreplace age_head_fem= age_ref  if              HW==0***Education***
label define educ_FAM 0 no_school 10 1st_8th_grade 11 9th_12th_grade 12 HS_diploma 13 Some_college 14 Associate_degree 15 BA_degree 16 Master 17 Doctorate
label values educ_ref educ_FAM
label values educa2 educ_FAM
gen     edu_head = educ_ref  if sex_ref==1 & HWreplace edu_head = educa2    if sex2==1    & HWreplace edu_head = educ_ref  if              HW==0gen     edu_head_fem = educ_ref  if sex_ref==2 & HWreplace edu_head_fem = educa2    if sex2==2    & HWreplace edu_head_fem = educ_ref  if              HW==0

*Generate 5 educational groups: for reference person and spouse
gen edu_head_5= edu_head
recode edu_head_5 0/11=1 12=2 13=3 14/16=4 17=5
gen edu_head_fem_5= edu_head_fem
recode edu_head_fem_5 0/11=1 12=2 13=3 14/16=4 17=5
label define educ_5 1 HS_dropout 2 HS_grad 3 Some_coll 4 BAs_Masters 5 Doctorate
label values edu_head_5 educ_5
label values edu_head_fem_5 educ_5

***Log hourly wages****Hourly wages of the reference person and the spouse defined using the following variables from the member file:* wage_ref_fromM wks_wrkd_ref_fromM hrsperwk_ref_fromM* wage_sp_fromM wks_wrkd_sp_fromM hrsperwk_sp_fromM*of the reference persongen hw_ref= wage_ref_fromM / (wks_wrkd_ref_fromM*hrsperwk_ref_fromM)recode hw_ref 0=.*recode hourly wages in the bottom and top 1 percent of the distribution with the p1 and p99 valuessum hw_ref if age_head>=18 & age_head<=65, det*save the first and the 99th percentiles of hrwage from previous "summarize, det" commandgen p1_hw_ref=r(p1)gen p99_hw_ref=r(p99)replace hw_ref= p1_hw_ref if hw_ref<p1_hw_ref  replace hw_ref= p99_hw_ref if hw_ref>p99_hw_ref  gen l_hw_ref= log(hw_ref) sum hw_ref l_hw_ref if age_head>=18 & age_head<=65, det*of the spousegen hw_spouse= wage_sp_fromM / (wks_wrkd_sp_fromM * hrsperwk_sp_fromM)*recode hourly wages in the bottom and top 1 percent of distribution at the p1 and p99 valuessum hw_spouse if age_head>=18 & age_head<=65, det*save the the first and 99th percentiles of hrwage from previous "summarize, det" commandgen p1_hw_spouse=r(p1)gen p99_hw_spouse=r(p99)replace hw_spouse= p1_hw_spouse if hw_spouse<p1_hw_spouse replace hw_spouse= p99_hw_spouse if hw_spouse>p99_hw_spouse  gen l_hw_spouse= log(hw_spouse)sum hw_spouse l_hw_spouse if age_head>=18 & age_head<=65, det*of the head (that is, conventionally the male in HW families) and the wifegen     hw_head= hw_ref     if sex_ref==1 & HWreplace hw_head= hw_spouse  if sex2==1    & HWreplace hw_head= hw_ref     if              HW==0*logarithmic transformationgen     l_hw_head= l_hw_ref     if sex_ref==1 & HWreplace l_hw_head= l_hw_spouse  if sex2==1    & HWreplace l_hw_head= l_hw_ref     if              HW==0gen     l_hw_wife= l_hw_ref     if sex_ref==2 & HWreplace l_hw_wife= l_hw_spouse  if sex2==2    & HW*************************************************************************************** SAMPLE RESTRICTIONSkeep if age_head>=18 & age_head<=65****************************************************************************************************************************************************************************************************************** NT_home: expenditure items that are likely to refer to services/goods that are substitutes for home production ******************************************************************************************************************************gen NT_home= food_away_full_service + drink_away_full_service + repair_maintain + delivery + housekeeping + babysitting + personal_caregen NT_home_sh= NT_home/tot_expenditurereg NT_home_sh if age_head>=18 & age_head<=65 & l_hw_head~=. [fweight= weight_round]by edu_head_5, sort: sum NT_home_sh [fweight = weight_round]***************************************************************************************************************************************B. GRAPHS of NT expenditure share (NT expenditure / total expenditure) for different educational levels / family types***************************************************************************************************************************************FIGURE 1* Bar graph of the budget share in home services, by education of the head (set to be the male in all HW families) and by family type graph bar (mean) NT_home_sh  if age_head>=18 & age_head<=65 & l_hw_head~=. [fweight = weight_round], over(edu_head_5, relabel(1 "HSD" 2 "HSG" 3 "CD" 4 "CG" 5 "PG")) by(fam_type3, total title(Figure 1))  ytitle (Household Expenditure Share of Home Services) stack ylabel(, angle(horizontal)) *FIGURE A1*in the case of husband & working wife families, use the education of the spouse instead of the education of the headgraph bar (mean) NT_home_sh  if age_head>=18 & age_head<=65 & l_hw_head~=. [fweight = weight_round], over(edu_head_fem_5, relabel(1 "HSD" 2 "HSG" 3 "CD" 4 "CG" 5 "PG")) by(fam_type3, total title(Figure A1))  ytitle (Household Expenditure Share of Home Services) stack ylabel(, angle(horizontal)) * FIGURE A2* Bar graph of composition of expenditures in non-traded services that subsitute for home production, by education of the headgraph bar (mean) food_away_full_service_sh (mean) drink_away_full_service_sh (mean) repair_maintain_sh (mean) delivery_sh (mean) housekeeping_sh (mean) babysitting_sh (mean) personal_care_sh if age_head>=18 & age_head<=65 & l_hw_head~=. [fweight = weight_round], over(edu_head_5, relabel(1 "< High School" 2 "HS grads" 3 "Some College" 4 "BA's/Masters" 5 "Doctorate")) title(Figure A2) ytitle (Household Budget Share) stack ylabel(, angle(horizontal))  legend(order(1 "food away" 2 "drinks away" 3 "repair" 4 "delivery" 5 "housekeeping" 6 "babysitting" 7 "personal care"))***********************************************************************************************************C. RELATIONSHIP between NT expenditure share (NT expenditure / total expenditure) and log hourly wages**********************************************************************************************************
* Distribution of family types on regression sample
tab fam_type3 if age_head>=18 & age_head<=65 & l_hw_head~=.
* Table 1: Correlation between household budget share of home production substitutes and household members' hourly wages; 2004*each regression corresponds to a column of the table*Column 1 - All families (Hourly wages of the reference person; any type of family)reg NT_home_sh  l_hw_head if age_head>=18 & age_head<=65 & l_hw_head~=. [fweight= weight_round], robust
*Column 2 - Husband/Wife families - Woman does NOT workreg NT_home_sh  l_hw_head if age_head>=18 & age_head<=65 & l_hw_head~=. & fam_type3==1  [fweight= weight_round], robust
* Column 3 - Husband/Wife families - Woman works
reg NT_home_sh  l_hw_head if age_head>=18 & age_head<=65 & l_hw_head~=. & fam_type3==2   [fweight= weight_round], robust
* Column 4 - Husband/Wife families - Woman works - include both head's and wife's wagereg NT_home_sh  l_hw_head l_hw_wife  if age_head>=18 & age_head<=65 & l_hw_head~=. & HW==1 & woman_work  [fweight= weight_round], robust	
*Other familiesreg NT_home_sh  l_hw_head if age_head>=18 & age_head<=65 & l_hw_head~=. & fam_type3==3   [fweight= weight_round], robust