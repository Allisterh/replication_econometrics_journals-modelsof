/* REPLICATION FILES for the article:
Spillovers from High-Skill Consumption to Low-Skill Labor Markets 
Francesca Mazzolari and Giuseppe Ragusa
REStat, March 2013, 95(1), 74-86

do file: 03_census.do

  This do file prepares the city-level datasets:
    1. msa80_90_00_05.dta
      The generated variables are population figures (number of "bodies", as of the census year)
	  and employment figures (number of hours worked, in the year prior to the census)
	  by educational level and sector
    2. msa80_90_00_05_wg.dta
      The generated variables are wage figures (mean and median hourly wages)
      by educational level and sector
*/


* Set path to WORKING DIRECTORY
cd ~/scratch/Repset more off*******************************************************
************ 1. Generate msa80_90_00_05.dta ******************************************************************use "data/indiv80_90_00_05.dta", clear*RESTRICT the analysis to the population that resides in a metropolitan statistical area (MSA)keep if metaread>0    /*metaread==0 not identifiable or not in an MSA*/
#delimit ;drop TR Agriculture_Mining Manufacturing CO WT FI BS ED PA Hotels  HOME_ind_eat HOME_ind_pers HOME_ind_child HOME_ind_other  HOME_occ otherNT_occ foreign_5yrs_orless foreign_10yrs_orless other_race;#delimit cr*Generate values to define msa-year share of elderly population (on overall 16+ population)by metaread year, sort: egen pop=total(perwt) gen perwt_over65 = perwt*age_over65by metaread year, sort: egen pop_over65=total(perwt_over65) drop perwt_over65* Generate values to define msa-year female labor force participationgen female=1-malegen perwt16_65_fem  = perwt*femaleby metaread year, sort: egen pop_fem=total(perwt16_65_fem) gen work_fem  = perwt*female*worksampby metaread year, sort: egen work_pop_fem=total(work_fem) drop perwt16_65_fem work_femkeep if age<=65
/*To check robustness of our results to Autor&Dorn hypothesis, identify "routine occupations" (see footnote 16 in the paper). Routine Task Index (RTI): average log routine/manual task ratio, calculated for each of 352 occupations*/gen routine_occ=(occ1990==313)            | ///  /*Secretaries*/	            (occ1990==314)            | ///  /*Stenographers*/	            (occ1990==383)            | ///  /*Bank tellers*/                (occ1990==96)             | ///  /*Pharmacists */                 (occ1990==338)            | ///  /*Payroll and timekeeping clerks */                     (occ1990==773)            | ///  /*Motion Picture projectionists */                 (occ1990==643)            | ///  /*Boilermakers */     	            (occ1990==686)            | ///  /*Butchers and meat cutters*/	            (occ1990==23)             | ///  /*Accountants and Auditors */   	            (occ1990==66)             | ///  /*Actuaries*/	            (occ1990==384)              ///  /*Proofreaders*/	            gen routine = lswt*routine_occ
compress * College Graduate/Non College Gradutategen notCG=1-CollegeGraduategen perwt16_65_notCG  = perwt*notCGgen perwt16_65_CG   = perwt*CollegeGraduate* Numbers of hours of employmentgen lswt16_65_notCG  = lswt*notCGgen lswt16_65_CG     = lswt*CollegeGraduateforeach x in HOME_ind otherNT_ind {gen `x'_16_65 = lswt*`x'gen notCG_`x' = lswt*notCG*`x'gen CG_`x'  = lswt*CollegeGraduate*`x'}foreach x in female black hispanic foreign age16_24 {gen lswt_`x'=lswt*`x' }gen lswt_fb_notCG=lswt*foreign*notCG* Generate wage bill share of top decile of hourly wage earnersgen wb = lswt*hrwage_CPI04by metaread year, sort: egen p90_hrwg=pctile(hrwage_CPI04), p(90)  gen d90=(hrwage_CPI04>=p90_hrwg)gen wb90 = lswt*hrwage_CPI04*d90sort year metaread
collapse (rawsum) pop16_65=perwt pop16_65_notCG=perwt16_65_notCG pop16_65_CG=perwt16_65_CG ///                  emp=lswt emp_notCG=lswt16_65_notCG emp_CG=lswt16_65_CG ///                  emp_HOME_ind=HOME_ind_16_65 emp_otherNT_ind=otherNT_ind_16_65 ///                  emp_routine=routine ///                  emp_HOME_ind_notCG=notCG_HOME_ind emp_otherNT_ind_notCG=notCG_otherNT_ind ///                  emp_HOME_ind_CG=CG_HOME_ind emp_otherNT_ind_CG=CG_otherNT_ind ///                  emp_fem=lswt_female emp_black=lswt_black  emp_hisp=lswt_hispanic emp16_24=lswt_age16_24 ///                  emp_fb=lswt_foreign emp_fb_notCG=lswt_fb_notCG ///                  wb wb90 ///        (mean)    pop pop_over65 pop_fem work_pop_fem ///                  mn_hrwg=hrwage_CPI04 ///     /*Remark: hrwage==. if wagesamp==0*/        (median)  md_hrwg=hrwage_CPI04 ///        (p10)     p10_hrwg=hrwage_CPI04 ///        (p90)     p90_hrwg=hrwage_CPI04 ///           (max)     statefip_max=statefip   region_max=region ///         (min)     statefip_min=statefip   region_min=region ///   /*Some msa cross state boundaries, so that getting the mean of this variable would deliver decimal numbers*/ [pweight=lswt], by (year metaread)save data/msa80_90_00_05.dta, replace

*******************************************************
*********** 2. Generate msa80_90_00_05_wg.dta *********
*******************************************************use "data/indiv80_90_00_05.dta", cleardrop if metaread==0 keep if wagesamp==1gen nonCG=1-CollegeGraduategen hrwg_HSD    = hrwage_CPI04 if HSdropoutgen hrwg_HSG    = hrwage_CPI04 if HSdegreegen hrwg_CD     = hrwage_CPI04 if someCollegegen hrwg_nonCG  = hrwage_CPI04 if nonCGgen non_HOME_ind=(HOME_ind==0)gen TR_WT = (TR==1 | WT==1)gen FI_BS = (FI==1 | BS==1)gen CO_Hot= (CO==1 | Hotels==1)gen PA_ED = (PA==1 | ED==1)gen nonNT= (TR==1 | WT==1 | FI==1 | BS==1 | ED==1 | PA==1)foreach x in TR CO WT FI BS ED PA HOME_ind otherNT_ind non_HOME_ind Hotels TR_WT FI_BS CO_Hot PA_ED nonNT {gen hrwg_`x'      = hrwage_CPI04 if `x'gen hrwg_nonCG_`x'   = hrwage_CPI04 if `x' & nonCG}set more offsort year metareacollapse (mean)   hrwg=hrwage_CPI04 hrwg_HSD=hrwg_HSD hrwg_HSG=hrwg_HSG hrwg_CD=hrwg_CD hrwg_nonCG=hrwg_nonCG ///                  hrwg_TR=hrwg_TR hrwg_nonCG_TR=hrwg_nonCG_TR  hrwg_WT=hrwg_WT hrwg_nonCG_WT=hrwg_nonCG_WT                  hrwg_TR_WT=hrwg_TR_WT hrwg_nonCG_TR_WT=hrwg_nonCG_TR_WT ///                  hrwg_CO=hrwg_CO hrwg_nonCG_CO=hrwg_nonCG_CO  hrwg_Hotels=hrwg_Hotels hrwg_nonCG_Hotels=hrwg_nonCG_Hotels  hrwg_CO_Hot=hrwg_CO_Hot hrwg_nonCG_CO_Hot=hrwg_nonCG_CO_Hot ///                  hrwg_FI=hrwg_FI hrwg_nonCG_FI=hrwg_nonCG_FI  hrwg_BS=hrwg_BS hrwg_nonCG_BS=hrwg_nonCG_BS                  hrwg_FI_BS=hrwg_FI_BS hrwg_nonCG_FI_BS=hrwg_nonCG_FI_BS ///                  hrwg_PA=hrwg_PA hrwg_nonCG_PA=hrwg_nonCG_PA  hrwg_ED=hrwg_ED hrwg_nonCG_ED=hrwg_nonCG_ED                  hrwg_PA_ED=hrwg_PA_ED hrwg_nonCG_PA_ED=hrwg_nonCG_PA_ED  ///                  hrwg_HOME_ind=hrwg_HOME_ind hrwg_nonCG_HOME_ind=hrwg_nonCG_HOME_ind  ///                  hrwg_otherNT_ind=hrwg_otherNT_ind hrwg_nonCG_otherNT_ind=hrwg_nonCG_otherNT_ind  ///                  hrwg_non_HOME_ind=hrwg_non_HOME_ind hrwg_nonCG_non_HOME_ind=hrwg_nonCG_non_HOME_ind  ///                  hrwg_nonNT=hrwg_nonNT hrwg_nonCG_nonNT=hrwg_nonCG_nonNT  ///         (median) m_hrwg=hrwage_CPI04 m_hrwg_HSD=hrwg_HSD m_hrwg_HSG=hrwg_HSG m_hrwg_CD=hrwg_CD m_hrwg_nonCG=hrwg_nonCG ///                  m_hrwg_TR=hrwg_TR m_hrwg_nonCG_TR=hrwg_nonCG_TR  m_hrwg_WT=hrwg_WT m_hrwg_nonCG_WT=hrwg_nonCG_WT                  m_hrwg_TR_WT=hrwg_TR_WT   m_hrwg_nonCG_TR_WT=hrwg_nonCG_TR_WT ///                  m_hrwg_CO=hrwg_CO m_hrwg_nonCG_CO=hrwg_nonCG_CO  m_hrwg_Hotels=hrwg_Hotels m_hrwg_nonCG_Hotels=hrwg_nonCG_Hotels  m_hrwg_CO_Hot=hrwg_CO_Hot m_hrwg_nonCG_CO_Hot=hrwg_nonCG_CO_Hot ///                  m_hrwg_FI=hrwg_FI m_hrwg_nonCG_FI=hrwg_nonCG_FI  m_hrwg_BS=hrwg_BS m_hrwg_nonCG_BS=hrwg_nonCG_BS                  m_hrwg_FI_BS=hrwg_FI_BS   m_hrwg_nonCG_FI_BS=hrwg_nonCG_FI_BS ///                  m_hrwg_PA=hrwg_PA m_hrwg_nonCG_PA=hrwg_nonCG_PA  m_hrwg_ED=hrwg_ED m_hrwg_nonCG_ED=hrwg_nonCG_ED                  m_hrwg_PA_ED=hrwg_PA_ED   m_hrwg_nonCG_PA_ED=hrwg_nonCG_PA_ED  ///                  m_hrwg_HOME_ind=hrwg_HOME_ind m_hrwg_nonCG_HOME_ind=hrwg_nonCG_HOME_ind  ///                  m_hrwg_otherNT_ind=hrwg_otherNT_ind m_hrwg_nonCG_otherNT_ind=hrwg_nonCG_otherNT_ind  ///                  m_hrwg_non_HOME_ind=hrwg_non_HOME_ind m_hrwg_nonCG_non_HOME_ind=hrwg_nonCG_non_HOME_ind  ///                  m_hrwg_nonNT=hrwg_nonNT m_hrwg_nonCG_nonNT=hrwg_nonCG_nonNT  ///[weight=lswt] ///, by (year metaread)save data/msa80_90_00_05_wg.dta, replace