******************************************************************************************This do-file generates the General Price Indices at different base-years used in T9*****************************************************************************************use $Data/sitc1_raw, clear*Keep commodities with price seriesgen sample_comm=.local comm 2 9 13 14 16 146 23 25 27 28 30 37 42 48 51 52 58 65 71 73 76 132 133 142 143 145 148 237 241 242 300 301 302foreach c of local comm {replace sample_comm=good if good==`c'}keep if sample_comm!=.keep code country year sitc1 value  good order year code country sitc1 value good bysort code year:egen total=sum(value)gen share=value/total*Check: shares sum to 1 for all countriessort country yearby country year:egen sum=sum(share)tab country if sum<0.9999 & sum!=0drop sumrename good princ_comm*Generate fixed yearslocal fixed 1975 1980 1990 2000 2001foreach c of local fixed{sort country princ_comm yearby country princ_comm:gen share_`c'=share if year==`c'by country princ_comm:egen aux=mean(share_`c')drop share_`c'rename aux share_`c'replace share_`c'=0 if share_`c'==.}*Generate average over the periodsort country princ_comm yearby country princ_comm:egen meanshare=mean(share)by country princ_comm:egen aux=mean(meanshare)drop meansharerename aux meansharereplace meanshare=0 if meanshare==.by country princ_comm:gen n=_nkeep if n==1drop year sitc1expand 48sort country princ_commby country princ_comm:egen year=seq()gen aux=year+1961drop yearrename aux yearkeep year country code princ_comm share_1975 share_1980 share_1990 share_2000 share_2001 meanshareorder year code country princ_comm share_1975 share_1980 share_1990 share_2000 share_2001 meanshare*Add price seriessort princ_comm yearmerge m:1 princ_comm year using  $Data/comm_index_gpisort country princ_comm yeardrop if code==.format cname stub_n %15sreplace price=1197 if princ_comm==65 & year==2007   //missing imported price for uranium 2007drop _m*General price indices at 1975, 1980, 1990, 2001 and average sharefor any 75 80 90: gen w_price_X=price*share_19Xfor any 00 01: gen w_price_X=price*share_20Xgen w_price=price*meansharelocal group 75 80 90 00 01foreach c of local group{bysort country year:egen gpi_`c'=sum(w_price_`c')}bysort country year:egen gpi=sum(w_price)*GSORTING YOU DEFINE N STARTING FROM THE MOST IMPORTANT SHARE (LATER YOU CAN CHECK IF IT COINCIDES WITH GENERAL PRINCIPAL COMMODITY) gsort country year -meanshareby country year:gen n=_n*Keep 1st observation per yearkeep if n==1local group 75 80 90 00 01foreach c of local group{replace gpi_`c'=. if gpi_`c'==0replace gpi_`c'=. if code==126 & year==1980replace gpi_`c'=. if code==90 & year==1962}*missing shares in these yearsreplace gpi_75=. if code==45 & year==1975for any 75 80: replace gpi_X=. if code==116 & year==1962replace gpi_80=. if code==149 & year==1985drop nkeep code country year share_1975 gpi_75 share_1980 gpi_80 share_1990 gpi_90 share_2000 gpi_00 share_2001 gpi_01 meanshare gpi sort code year*Rebase gpi at year 2000local group 75 80 90 00 01foreach c of local group{by code:gen aux=gpi_`c' if year==2000by code:egen aux2=mean(aux)drop auxrename aux2 auxgen aux_gpi_`c'=(gpi_`c'/aux)*100drop gpi_`c' auxrename aux_gpi_`c' gpi_`c' }by code:gen aux=gpi if year==2000by code:egen aux2=mean(aux)drop auxrename aux2 auxgen aux_gpi=(gpi/aux)*100drop gpi auxrename aux_gpi gpi*************************save "$Output_aux/gpi",replace