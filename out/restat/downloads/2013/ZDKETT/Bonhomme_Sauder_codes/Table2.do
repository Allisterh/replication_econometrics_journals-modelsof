*******  This program runs the 2SLS regresssions ***************  Table 2 in the paper *************** The program uses Stata 10, with the Mata extension ********clearset mem 300mset matsize 600set more off* CHANGE THIS PATH VARIABLE TO YOUR PATH.cd \Users\uli\Desktop\Data_construction_comp\_submission_restatlocal y="math16"local w1="math11"** Prepare outputset obs 12local j=1while `j'<=4{gen cov`j'=.gen cov`j'std=.local j=`j'+1}save table2, replace** Start loop on the covariateslocal ncov=1while `ncov'<=4{if `ncov'==1{local option="one"}else if `ncov'==2{local option="two"}else if `ncov'==3{local option="three"}else if `ncov'==4{local option="six"}** Start loop on the instruments Zlocal ninst=1while `ninst'<=3{if `ninst'==1{local z1="math7 read7"}else if `ninst'==2{local z1="draw copy"}else if `ninst'==3{local z1="FEDUC MEDUC"}** Load the data use samplefinal, clear** Keep children with non-missing parental education when the Z's used are (FEDUC,MEDUC)local FEDUClist="FEDUC MEDUC"local aa : list FEDUClist==z1if `aa'==1 {keep if FEDUCmiss==0 & MEDUCmiss==0local zerolist=""}else {local zerolist="FEDUC MEDUC FEDUCmiss MEDUCmiss"}** Covariates: seven possible choiceslocal onelist "`zerolist' cmsex sc580-sc584 sc58miss sc69* sc1965* sc65miss oldersib oldersibmiss mwork65 mwork65miss MINC1-MINC2 FINC1-FINC4" local twolist "`onelist' stay65 stay65miss nchildc65 nchildc65miss noschool noschoolmiss ptr69 ptr69miss junior69 buildage69 buildage69miss nostream69"local threelist "`twolist' RE161-RE169"*!RESTRICTED - need special license access.*local fourlist "`threelist' lab_cont pop_size pop_dens indus"local fivelist "`threelist' comp67b comp72b"** Sixlist is a list of interacted covariateslocal a: list sixlist==`option'listif `a'==1{if `aa'==0{local sixlist "cmsex FEDUC sc580-sc584 nchildc65 junior69 buildage69 nostream69 RE161-RE169"foreach vv of varlist `sixlist'{foreach ww of varlist `sixlist'{gen `vv'`ww'=`vv'*`ww'}}local sixlist "cmsex* FEDUC* sc58* nchildc65* junior69* buildage69* nostream69* RE161*"#delimit ;local sixlist "`sixlist' sc69* sc58miss sc1965* sc65miss oldersib oldersibmiss mwork65 mwork65miss MINC1-MINC2 FINC1-FINC4 stay65 stay65miss nchildc65miss noschool noschoolmiss ptr69 ptr69miss  buildage69miss";#delimit crqui drop cmsexcmsex cmsexFEDUC cmsexnchildc65 FEDUCsc581 FEDUCsc582 FEDUCbuildage69 FEDUCnostream69 FEDUCRE161 qui drop sc580cmsex sc580FEDUC sc580sc580 sc580sc581 sc580sc582 sc580sc583 sc580sc584 qui drop sc580nchildc65 sc580nostream69 sc581cmsex sc581sc580 sc581sc581 sc581sc582 qui drop sc581sc583 sc581sc584 sc582cmsex sc582sc580 sc582sc581 sc582sc582 qui drop sc582sc583 sc582sc584 sc582nostream69 sc583cmsex sc583FEDUC sc583sc580 sc583sc581 qui drop sc583sc582 sc583sc583 sc583sc584 sc584cmsex sc584FEDUC sc584sc580 qui drop sc584sc581 sc584sc582 sc584sc583 sc584sc584 sc584RE161 nchildc65FEDUC qui drop nchildc65sc581 nchildc65sc582 nchildc65sc583 nchildc65sc584 qui drop nchildc65junior69 junior69cmsex junior69FEDUC junior69sc580 junior69sc581 qui drop junior69sc582 junior69sc583 junior69sc584 junior69junior69 buildage69cmsex qui drop buildage69sc580 buildage69sc581 buildage69sc582 buildage69sc583 buildage69sc584 qui drop buildage69nchildc65 buildage69junior69 nostream69cmsex nostream69sc581 nostream69sc583 nostream69sc584 nostream69nchildc65 qui drop nostream69junior69 nostream69buildage69 nostream69nostream69qui drop RE161 RE161cmsex RE161sc58* RE161nchildc65 RE161junior69 RE161buildage69 RE161nostream69 RE161RE* }else if `aa'==1{local sixlist "cmsex sc580-sc584 nchildc65 junior69 buildage69 nostream69 RE161-RE169"foreach vv of varlist `sixlist'{foreach ww of varlist `sixlist'{gen `vv'`ww'=`vv'*`ww'}}local sixlist "cmsex* sc58* nchildc65* junior69* buildage69* nostream69* RE161*"#delimit ;local sixlist "`sixlist' sc69* sc58miss sc1965* sc65miss oldersib oldersibmiss mwork65 mwork65miss MINC1-MINC2 FINC1-FINC4 stay65 stay65miss nchildc65miss noschool noschoolmiss ptr69 ptr69miss  buildage69miss";#delimit crqui drop cmsexcmsex cmsexnchildc65  qui drop sc580cmsex  sc580sc580 sc580sc581 sc580sc582 sc580sc583 sc580sc584 qui drop sc580nchildc65 sc580nostream69 sc581cmsex sc581sc580 sc581sc581 sc581sc582 qui drop sc581sc583 sc581sc584 sc582cmsex sc582sc580 sc582sc581 sc582sc582 qui drop sc582sc583 sc582sc584 sc582nostream69 sc583cmsex  sc583sc580 sc583sc581 qui drop sc583sc582 sc583sc583 sc583sc584 sc584cmsex  sc584sc580 qui drop sc584sc581 sc584sc582 sc584sc583 sc584sc584 sc584RE161  qui drop nchildc65sc581 nchildc65sc582 nchildc65sc583 nchildc65sc584 qui drop nchildc65junior69 junior69cmsex  junior69sc580 junior69sc581 qui drop junior69sc582 junior69sc583 junior69sc584 junior69junior69 buildage69cmsex qui drop buildage69sc580 buildage69sc581 buildage69sc582 buildage69sc583 buildage69sc584 qui drop buildage69nchildc65 buildage69junior69 nostream69cmsex nostream69sc581 nostream69sc583 nostream69sc584 nostream69nchildc65 qui drop nostream69junior69 nostream69buildage69 nostream69nostream69qui drop RE161 RE161cmsex RE161sc58* RE161nchildc65 RE161junior69 RE161buildage69 RE161nostream69 RE162RE* }}** Keep observations with non-missing dependent/independent variables keep ``option'list' `y' `w1' `z1' C GRAM SECMOD qui reg `y' ``option'list'  `w1' `z1' Ckeep if e(sample)if `ncov'<4{qui ivreg2 `y' (`w1'=`z1') ``option'list' if C==1, first}else if `ncov'==4{qui ivreg2 `y' (`w1'=`z1') ``option'list' if C==1, first}matrix eb=e(b)matrix efirst=e(first)matrix eV=e(V)use table2, clear** coefficient of math11replace cov`ncov'=eb[1,1] if _n==1+(`ninst'-1)*4** stad error of coefficient of math11replace cov`ncov'std=sqrt(eV[1,1]) if _n==1+(`ninst'-1)*4** Shea's partial R2replace cov`ncov'=efirst[1,1] if _n==2+(`ninst'-1)*4** F statisticreplace cov`ncov'=efirst[3,1] if _n==3+(`ninst'-1)*4** Sargan p-valueif `ncov'<4{replace cov`ncov'=e(jp) if _n==4+(`ninst'-1)*4}else if `ncov'==4{replace cov`ncov'=e(sarganp) if _n==4+(`ninst'-1)*4}save table2, replacelocal ninst=`ninst'+1}local ncov=`ncov'+1}use table2, clearlist