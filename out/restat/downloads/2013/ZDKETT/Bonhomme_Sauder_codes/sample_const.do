/* Data file to construct the sample used in the paper 'RECOVERING DISTRIBUTIONS IN DIFFERENCE-IN-DIFFERENCES MODELS: A COMPARISON OF SELECTIVE AND COMPREHENSIVE SCHOOLING'This file: created 23062012Modified: 25082012Author: USWebsite for NCDS: http://www.esds.ac.uk/longitudinal/access/ncds/l33004.asp****************************************************************************Conditions of data deposit have drastically changed,some data used is no longer accessible outside of the UK.Therefore, we uncommented code and markt it !RESTRICTED!in order for the users who may satisfy the criteria to reproducethe results in the paper fully.Remark: The authors are currently NOT affiliated to an UK institutionand therefore do not have access to this extended dataset.****************************************************************************Files from the NCDS and ESDS (www.data-archive.ac.uk) needed:ncds0123.dta					- NCDS Waves 0-3ncds4.dta						- NCDS Wave 4ncds5cmi.dta					- NCDS Wave 5: Cohort Member Interviewncds6.dta						- NCDS Wave 6*/capture log close* CHANGE THIS PATH VARIABLE TO YOUR PATH.cd \Users\uli\Desktop\Data_construction_comp\_submission_restatlog using mergecomp.smcl, replaceclearset mem 500mset more off/* Start out with Waves 0-3 */use ncds0123.dta/* Keeping only relevant variables to save memory */*!RESTRICTED!: n2268#delimit ;keep ncdsid n103 n104 n2383 n1212 n622 n236 n526 n2396 n2397 n1434 n1436 n1734 n2371 n2375 n2471 n2284 n2286 n2729 n2741 n2363 n2365 n197 n1008 n0region n1region n2region n3region n490 n492 n494 n537 n660 n95 n15n97 n99 n419 n112 n190 n22 n24 n20 n13 n46 n90 n457 n1840 n92 n1135 n1685 n1687 n1171 n1172 n1175 n824 n825 n829 n832n835 n836 n837 n845 n848 n858 n861 n862 n865 n866 n875 n914 n917 n920 n923 n926 n929 n2384 n2385 n2393 n2394 n2462 n2463n2465 n2466 n2467 n2491 n2492 n1737 n1897 n2269 n2102 n2103 n2104 n2108 n2112 n2115 n2116 n2141 n2161 n2162 n1721 n14n2928 n2930 n2137 n2139 n2144 n2170 n2157 n812 n813 n838 n839 n840 n841 n116 n2403 n2407 n2324 n2325 n2879 n2193 n2200;#delimit crsort ncdsidlist ncdsid if ncdsid==ncdsid[_n-1]save ncds0123bis.dta, replace/* Continue with Wave 4 */use ncds4.dta/* Keeping only relevant variables within Wave 4 to save memory */#delimit ;keep ncdsid	n4223 n4227 n4228 n4229 n4262 n4267 n4268 n4269 n4274 n4275 n4213 n4331 n4421 n622_4 n4region n4364 n4369	n4370 n4371	n4376 n4377 n4529 n4715	n5970 n5971	n5973 n5974	n6117 n6119	n6121 n6126	n6128 n6130	n6132 n6246	n6248	n6250 maxqual maxqual2 educqul trainqul	newghsq	currsoc	partsoc	secgenhh nofoch	dhhsize	n4223pw	n4262pw	n4269pw	n4341pw	n4364pw	n4371pw	n5164pw	earngsn	earngsg	famnet famgrs estge1 estfamg1 dempstat pempstat	n4262ph	n4269ph	n4364ph	n4371ph	famnetr	famgrsr	feqn1 famnet1 famgrs1 feqn feqn2 n4262ph1 n4262ph2 n4262ph3	n4262ph4	n4269ph1 n4269ph2 n4269ph3 n4269ph4	n4364ph1 n4364ph2 n4364ph3 n4364ph4	n4371ph1 n4371ph2 n4371ph3 n4371ph4;#delimit crsave ncds4bis.dta, replacesort ncdsidlist ncdsid if ncdsid==ncdsid[_n-1]joinby ncdsid using ncds0123bis, unmatched(both)rename _merge merge1duplicates report ncdsidsave ncds0to4bis.dta, replace*** !RESTRICTED! ***/* Derive LEA information -> uncomment if you have access to local data.g la=n2092 if n2092~=-1replace la=n2268 if n2268~=-1 & la==.* Could use further information below, but medical exam not always in same lea: *replace la=n1879 if n1879~=-1 & la==.*replace la=n2349 if n2349~=-1 & la==.*replace la=n2702 if n2702~=-1 & la==.*replace la=n2918 if n2918~=-1 & la==.*replace la=n2048 if n2048~=-1 & la==./* one LEA, middlesex, does not exist anymore. replace by hertfordshire */replace la=431 if la==542/* Drop Isle of Man, Iles of Scilly, Guernsey, Jersey,dunbartonshire, edinburgh SINCE diferent education system. */drop if (la==75|la==700|la==701|la==702|la==1055|la==1080)sort la** Use dataset SN199 from the UK data archive. A mapping file of LEA's is provided in our submission.use leastatssort lajoinby la using s24, unmatched(both)rename _merge merge18sort seriallist serial  if serial==serial[_n-1]drop merge18*/use ncds5cmi_modsort ncdsidlist ncdsid if ncdsid==ncdsid[_n-1]joinby ncdsid using ncds0to4bis, unmatched(both)rename _merge merge2duplicates report ncdsidsave ncds0to5bis.dta, replaceuse ncds6_modsort ncdsidlist ncdsid if ncdsid==ncdsid[_n-1]joinby ncdsid using ncds0to5bis, unmatched(both)rename _merge merge3duplicates report ncdsidsave compstep1out, replace